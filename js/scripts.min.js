function replaceAtIndex(_string,_index,_newValue) {
    split_string = _string.substring(0, _index) + ' ' + _string.substring(_index + 1);
    return_string = split_string.split('');
    return_string[_index] = '*';
    return_string = return_string.join('');
    return return_string;
}

$(document).ready(function() {
    function e() {
        $(".generated").remove(),
            $(".clear").remove();
        for (var e = $("textarea").val().split("\n"), t = 0; t < e.length; t++)
            $(".output").append('<div class="generated">' + e[t].slice(0) + '</div><div class="clear"></div>');
        $(".generated").each(function() {
            txtString = $(this).text();
            if(txtString.includes("mondja") && txtString[0] != "*" && txtString.includes("*")){
                var parts = txtString.split('*');
                for (var i= parts.length; i-->1;) {
                    parts.splice(i, 0, '*');
                }
                var act = 0;
                for (var i=0; i<parts.length; i++)
                {
                    if(parts[i] == "*")
                    {
                        if(act == 0)
                        {
                            parts[i] = "<a class='me'>*";
                            act = 1;
                        }
                        else
                        {
                            parts[i] = "*<a class='white'>";
                            act = 0;
                        }
                    }
                    this.innerHTML = parts.join("");
                }
            }
            txtString[0] == "*" && $(this).addClass("me"),
            txtString.toLowerCase().indexOf(" (( ") >= 0 && $(this).addClass("do"),
            txtString[0] == ">" && $(this).addClass("ame"),
            txtString.toLowerCase().indexOf(" mondja:") >= 0 && $(this).addClass("white"),
            txtString.toLowerCase().indexOf(" rádióba:") >= 0 && $(this).addClass("grey"),
            txtString.toLowerCase().indexOf("**[ch: ") >= 0 && $(this).addClass("radios"),
            txtString || $(this).remove(),
                $(".generated").css("background-color", "#" + $("#color-picker").spectrum("get").toHex())

        })
    }
    charName = $("#name").val().toLowerCase();
    var t = $.jStorage.get("lastCharName");
    t || $.jStorage.set("lastCharName", ""),
        $("#name").val($.jStorage.get("lastCharName")),
        $("#name").bind("input propertychange", function() {
            charName = $("#name").val().toLowerCase(),
                $.jStorage.set("lastCharName", charName),
                e()
        });
    var r = $.jStorage.get("lastFontSize")
        , o = $.jStorage.get("lastLineHeight");
    r || o ? ($(".output").css({
        "font-size": $.jStorage.get("lastFontSize") + "px",
        "line-height": $.jStorage.get("lastLineHeight") + "px"
    }),
        $("#font-label").text("Betűméret (" + $.jStorage.get("lastFontSize") + "px):")) : ($.jStorage.set("lastFontSize", "12"),
        $.jStorage.set("lastLineHeight", "0")),
        $("#decrease-fontsize").click(function() {
            currentSize = parseInt($(".output").css("font-size")),
                currentSize--,
                currentLineHeight = parseInt($(".output").css("line-height")),
                currentLineHeight--,
                currentLineHeight >= 0 ? ($(".output").css({
                    "font-size": currentSize + "px",
                    "line-height": currentLineHeight + "px"
                }),
                    $("#font-label").text("Betűméret (" + currentSize + "px):"),
                    $.jStorage.set("lastFontSize", currentSize),
                    $.jStorage.set("lastFontSize", currentLineHeight)) : $(this).addClass("disabled")
        }),
        $("#increase-fontsize").click(function() {
            currentSize = parseInt($(".output").css("font-size")),
                currentSize++,
                currentLineHeight = parseInt($(".output").css("line-height")),
                currentLineHeight++,
                $(".output").css({
                    "font-size": currentSize + "px",
                    "line-height": currentLineHeight + "px"
                }),
                $("#font-label").text("Betűméret (" + currentSize + "px):"),
                $.jStorage.set("lastFontSize", currentSize),
                $.jStorage.set("lastLineHeight", currentLineHeight),
                $("#decrease-fontsize").removeClass("disabled")
        }),
        $("#reset-fontsize").click(function() {
            $(".output").css({
                "font-size": "12px",
                "line-height": "0px"
            }),
                $("#font-label").text("Betűméret (12px):"),
                $.jStorage.set("lastFontSize", "12"),
                $.jStorage.set("lastLineHeight", "0")
        }),
        $("textarea").bind("input propertychange", function() {
            e()
        }),
        $("#color-picker").spectrum({
            color: "#000",
            showInput: !0,
            preferredFormat: "hex",
            change: function() {
                $.jStorage.set("lastColor", $("#color-picker").spectrum("get").toHex()),
                    $(".generated").css("background-color", "#" + $("#color-picker").spectrum("get").toHex())
            }
        }),
        $("#color-picker").spectrum("set", $.jStorage.get("lastColor"))
});
setInterval(()=>{
        $("code").css("background-color", "#" + $("#color-picker").spectrum("get").toHex())
    }
    , 0);

function capture() {
    html2canvas(document.querySelector("#capture")).then(canvas=>{
            document.getElementById("generatedImage").innerHTML = "Generált kép:<br>";
            document.getElementById("generatedImage").appendChild(canvas);
        }
    );
    console.log("canvas ok")
}
